<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>å¤§æ˜æ¼‚æµ | MingDynasty</title>
    <link rel="icon" href="https://MingDynasty1.github.io/000000000000000000.png" type="image/png">
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
  
  <!-- Tailwind é…ç½® -->
  <script>
    tailwind.config = {
      darkMode: 'class',
      theme: {
        extend: {
          colors: {
            // æ˜æœé£æ ¼é…è‰²
            ming: {
              red: '#C42021',     // æœ±çº¢
              gold: '#D4AF37',    // éé‡‘
              blue: '#1A5599',    // é’èŠ±è“
              green: '#2A6F39',   // æ¾ç»¿
              paper: '#F5F0E1',   // å®£çº¸è‰²
              ink: '#232323',     // å¢¨è‰²
              darkPaper: '#2C2821',// æš—è‰²æ¨¡å¼å®£çº¸
            },
          },
          fontFamily: {
            ming: ['"Ma Shan Zheng"', 'cursive', 'sans-serif'],
          },
          backgroundImage: {
            'ming-pattern': "url('https://picsum.photos/id/152/1000/1000')", // å¤é£çº¹ç†
          }
        },
      }
    }
  </script>
  
  <style type="text/tailwindcss">
    @layer utilities {
      .content-auto {
        content-visibility: auto;
      }
      .ming-border {
        border-image: linear-gradient(to right, #D4AF37, #C42021, #D4AF37) 1;
      }
      .text-shadow-ming {
        text-shadow: 2px 2px 0px rgba(0,0,0,0.3);
      }
      .game-shadow {
        box-shadow: 0 8px 30px rgba(0,0,0,0.2);
      }
      .character-shadow {
        filter: drop-shadow(0 4px 3px rgba(0,0,0,0.3));
      }
    }
    
    /* æ¸¸æˆç”»å¸ƒæ ·å¼ */
    canvas {
      image-rendering: pixelated;
      image-rendering: crisp-edges;
    }
    
    /* å¹³æ»‘è¿‡æ¸¡ */
    * {
      transition: background-color 0.3s ease, color 0.3s ease, border-color 0.3s ease;
    }
    
    /* æ»šåŠ¨æ¡ç¾åŒ– */
    ::-webkit-scrollbar {
      width: 8px;
      height: 8px;
    }
    ::-webkit-scrollbar-track {
      background: theme('colors.ming.paper');
      dark:bg-theme('colors.ming.darkPaper');
    }
    ::-webkit-scrollbar-thumb {
      background: theme('colors.ming.blue');
      border-radius: 4px;
    }
    ::-webkit-scrollbar-thumb:hover {
      background: theme('colors.ming.red');
    }
  </style>
  
  <!-- å¼•å…¥ä¹¦æ³•å­—ä½“ -->
  <link href="https://fonts.googleapis.com/css2?family=Ma+Shan+Zheng&display=swap" rel="stylesheet">
</head>

<body class="min-h-screen bg-ming-paper dark:bg-ming-darkPaper text-ming-ink dark:text-ming-paper font-ming overflow-x-hidden">
  <!-- é¡µé¢åŠ è½½æ£€æµ‹ -->
  <script>
    // è‡ªåŠ¨æ£€æµ‹æš—è‰²æ¨¡å¼
    if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
      document.documentElement.classList.add('dark');
    }
    
    // ç›‘å¬ç³»ç»Ÿä¸»é¢˜å˜åŒ–
    window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', e => {
      if (e.matches) {
        document.documentElement.classList.add('dark');
      } else {
        document.documentElement.classList.remove('dark');
      }
    });
  </script>

  <!-- å¤´éƒ¨ -->
  <header class="py-4 px-6 border-b border-ming-gold/50 dark:border-ming-gold/30 flex justify-between items-center">
    <h1 class="text-[clamp(1.5rem,3vw,2.5rem)] font-bold text-ming-red dark:text-ming-gold text-shadow-ming">
      <i class="fa fa-ship mr-2"></i>å¤§æ˜æ¼‚æµ
    </h1>
    
    <div class="flex items-center gap-4">
      <!-- ä¸»é¢˜åˆ‡æ¢æŒ‰é’® -->
      <button id="themeToggle" class="p-2 rounded-full hover:bg-ming-blue/20 dark:hover:bg-ming-blue/30 transition-all">
        <i class="fa fa-moon-o dark:hidden text-xl"></i>
        <i class="fa fa-sun-o hidden dark:block text-xl text-ming-gold"></i>
      </button>
      
      <!-- å£°éŸ³æ§åˆ¶ -->
      <button id="soundToggle" class="p-2 rounded-full hover:bg-ming-blue/20 dark:hover:bg-ming-blue/30 transition-all">
        <i class="fa fa-volume-up text-xl"></i>
      </button>
    </div>
  </header>

  <main class="container mx-auto px-4 py-8 max-w-7xl">
    <!-- æ¸¸æˆé€‰æ‹©é¢æ¿ -->
    <div id="gameMenu" class="mb-8 p-6 bg-white/80 dark:bg-ming-ink/80 rounded-lg game-shadow border border-ming-gold/40">
      <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
        <!-- æ¨¡å¼é€‰æ‹© -->
        <div class="p-4 border border-ming-blue/30 rounded-lg">
          <h2 class="text-xl font-bold text-ming-blue mb-3 border-b pb-2">æ¸¸æˆæ¨¡å¼</h2>
          <div class="space-y-2">
            <label class="flex items-center gap-2 p-2 rounded hover:bg-ming-blue/10 cursor-pointer">
              <input type="radio" name="gameMode" value="endless" checked class="accent-ming-red">
              <span>æ— å°½æ¼‚æµ</span>
            </label>
            <label class="flex items-center gap-2 p-2 rounded hover:bg-ming-blue/10 cursor-pointer">
              <input type="radio" name="gameMode" value="obstacle" class="accent-ming-red">
              <span>éšœç¢æŒ‘æˆ˜èµ›</span>
            </label>
            <label class="flex items-center gap-2 p-2 rounded hover:bg-ming-blue/10 cursor-pointer">
              <input type="radio" name="gameMode" value="timed" class="accent-ming-red">
              <span>è®¡æ—¶ç«é€Ÿèµ›</span>
            </label>
          </div>
        </div>
        
        <!-- äººç‰©é€‰æ‹© -->
        <div class="p-4 border border-ming-blue/30 rounded-lg">
          <h2 class="text-xl font-bold text-ming-blue mb-3 border-b pb-2">é€‰æ‹©è§’è‰²</h2>
          <div class="grid grid-cols-3 gap-2">
            <div class="character-option selected p-2 rounded border-2 border-ming-red text-center hover:bg-ming-red/10 cursor-pointer transition-all" data-char="scholar">
              <div class="text-3xl mb-1 character-shadow">ğŸ“</div>
              <span class="text-sm">æ–‡ç”Ÿ</span>
            </div>
            <div class="character-option p-2 rounded border-2 border-transparent text-center hover:bg-ming-red/10 cursor-pointer transition-all" data-char="general">
              <div class="text-3xl mb-1 character-shadow">âš”ï¸</div>
              <span class="text-sm">æ­¦å°†</span>
            </div>
            <div class="character-option p-2 rounded border-2 border-transparent text-center hover:bg-ming-red/10 cursor-pointer transition-all" data-char="merchant">
              <div class="text-3xl mb-1 character-shadow">ğŸ’°</div>
              <span class="text-sm">å•†è´¾</span>
            </div>
          </div>
        </div>
        
        <!-- éš¾åº¦é€‰æ‹© -->
        <div class="p-4 border border-ming-blue/30 rounded-lg">
          <h2 class="text-xl font-bold text-ming-blue mb-3 border-b pb-2">éš¾åº¦è®¾ç½®</h2>
          <div class="space-y-2">
            <label class="flex items-center gap-2 p-2 rounded hover:bg-ming-blue/10 cursor-pointer">
              <input type="radio" name="difficulty" value="easy" checked class="accent-ming-red">
              <span>æ˜“ - æ±Ÿå—æ°´ä¹¡</span>
            </label>
            <label class="flex items-center gap-2 p-2 rounded hover:bg-ming-blue/10 cursor-pointer">
              <input type="radio" name="difficulty" value="medium" class="accent-ming-red">
              <span>ä¸­ - é•¿æ±Ÿæ¿€æµ</span>
            </label>
            <label class="flex items-center gap-2 p-2 rounded hover:bg-ming-blue/10 cursor-pointer">
              <input type="radio" name="difficulty" value="hard" class="accent-ming-red">
              <span>éš¾ - ä¸œæµ·æ€’æ¶›</span>
            </label>
          </div>
        </div>
      </div>
      
      <!-- å¼€å§‹æ¸¸æˆæŒ‰é’® -->
      <div class="mt-6 text-center">
        <button id="startGame" class="px-8 py-3 bg-ming-red hover:bg-ming-red/80 text-white rounded-lg text-xl game-shadow transition-all transform hover:scale-105 active:scale-95">
          <i class="fa fa-play mr-2"></i>å¼€å§‹æ³›èˆŸ
        </button>
      </div>
    </div>
    
    <!-- æ¸¸æˆåŒºåŸŸ -->
    <div id="gameArea" class="hidden relative">
      <!-- æ¸¸æˆç”»å¸ƒå®¹å™¨ -->
      <div class="relative aspect-video max-w-5xl mx-auto bg-ming-blue/10 dark:bg-ming-blue/20 rounded-lg overflow-hidden game-shadow border-2 border-ming-gold">
        <canvas id="gameCanvas" class="w-full h-full"></canvas>
        
        <!-- æ¸¸æˆUIå åŠ å±‚ -->
        <div id="gameUI" class="absolute inset-0 pointer-events-none">
          <!-- åˆ†æ•°æ˜¾ç¤º -->
          <div class="absolute top-4 left-4 bg-black/50 text-white px-3 py-1 rounded-lg text-lg">
            é‡Œç¨‹: <span id="scoreDisplay">0</span> ä¸ˆ
          </div>
          
          <!-- è®¡æ—¶æ˜¾ç¤º (è®¡æ—¶èµ›æ¨¡å¼) -->
          <div id="timerDisplay" class="absolute top-4 right-4 bg-black/50 text-white px-3 py-1 rounded-lg text-lg hidden">
            æ—¶é—´: <span>00:00</span>
          </div>
          
          <!-- ç”Ÿå‘½å€¼æ˜¾ç¤º -->
          <div class="absolute bottom-4 left-4 flex gap-1">
            <div class="life-icon w-6 h-6 bg-ming-red rounded-full"></div>
            <div class="life-icon w-6 h-6 bg-ming-red rounded-full"></div>
            <div class="life-icon w-6 h-6 bg-ming-red rounded-full"></div>
          </div>
          
          <!-- æš‚åœæŒ‰é’® -->
          <button id="pauseBtn" class="absolute top-4 left-1/2 -translate-x-1/2 bg-black/50 text-white px-3 py-1 rounded-lg pointer-events-auto hover:bg-black/70">
            <i class="fa fa-pause"></i> æš‚åœ
          </button>
        </div>
        
        <!-- æ¸¸æˆå¼€å§‹ç•Œé¢ -->
        <div id="gameStartOverlay" class="absolute inset-0 bg-black/70 flex flex-col items-center justify-center pointer-events-auto">
          <h2 class="text-3xl text-white mb-4">å‡†å¤‡å‡ºå‘!</h2>
          <p class="text-white mb-6">ä½¿ç”¨ <span class="text-ming-gold">â† â†’</span> æ–¹å‘é”®æ§åˆ¶æœ¨èˆŸï¼Œé¿å¼€éšœç¢</p>
          <button id="startBtn" class="px-6 py-2 bg-ming-red text-white rounded hover:bg-ming-red/80">
            <i class="fa fa-play mr-2"></i>å¼€å§‹
          </button>
        </div>
        
        <!-- æ¸¸æˆæš‚åœç•Œé¢ -->
        <div id="gamePauseOverlay" class="absolute inset-0 bg-black/70 flex flex-col items-center justify-center pointer-events-none opacity-0">
          <h2 class="text-3xl text-white mb-4">æ¸¸æˆæš‚åœ</h2>
          <div class="flex gap-4">
            <button id="resumeBtn" class="px-6 py-2 bg-ming-green text-white rounded hover:bg-ming-green/80">
              <i class="fa fa-play mr-2"></i>ç»§ç»­
            </button>
            <button id="restartBtn" class="px-6 py-2 bg-ming-red text-white rounded hover:bg-ming-red/80">
              <i class="fa fa-refresh mr-2"></i>é‡æ–°å¼€å§‹
            </button>
          </div>
        </div>
        
        <!-- æ¸¸æˆç»“æŸç•Œé¢ -->
        <div id="gameOverOverlay" class="absolute inset-0 bg-black/70 flex flex-col items-center justify-center pointer-events-none opacity-0">
          <h2 class="text-3xl text-white mb-2">æ¸¸æˆç»“æŸ</h2>
          <p class="text-white mb-4">æœ€ç»ˆé‡Œç¨‹: <span id="finalScore" class="text-ming-gold">0</span> ä¸ˆ</p>
          <button id="playAgainBtn" class="px-6 py-2 bg-ming-red text-white rounded hover:bg-ming-red/80">
            <i class="fa fa-refresh mr-2"></i>å†ç©ä¸€æ¬¡
          </button>
        </div>
      </div>
      
      <!-- æ¸¸æˆæ§åˆ¶è¯´æ˜ -->
      <div class="mt-6 p-4 bg-white/80 dark:bg-ming-ink/80 rounded-lg game-shadow border border-ming-gold/40">
        <h3 class="text-xl font-bold text-ming-blue mb-2">æ“ä½œè¯´æ˜</h3>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <div>
            <p><i class="fa fa-arrow-left text-ming-red mr-2"></i> å·¦ç§»æœ¨èˆŸ</p>
            <p><i class="fa fa-arrow-right text-ming-red mr-2"></i> å³ç§»æœ¨èˆŸ</p>
            <p><i class="fa fa-space-shuttle text-ming-red mr-2"></i> ç©ºæ ¼é”® åŠ é€Ÿ (é™æ—¶)</p>
          </div>
          <div>
            <p><i class="fa fa-pause text-ming-red mr-2"></i> ESCé”® æš‚åœæ¸¸æˆ</p>
            <p><i class="fa fa-life-ring text-ming-red mr-2"></i> æ”¶é›†é“å…·å¯è·å¾—ç”Ÿå‘½æˆ–åŠ é€Ÿ</p>
            <p><i class="fa fa-trophy text-ming-red mr-2"></i> å°½å¯èƒ½æ¼‚æµæ›´è¿œçš„è·ç¦»</p>
          </div>
        </div>
      </div>
    </div>
    
    <!-- æ¸¸æˆç»Ÿè®¡ -->
    <div id="gameStats" class="mt-8 p-6 bg-white/80 dark:bg-ming-ink/80 rounded-lg game-shadow border border-ming-gold/40 hidden">
      <h2 class="text-xl font-bold text-ming-blue mb-4 border-b pb-2">æ¸¸æˆç»Ÿè®¡</h2>
      <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
        <div class="text-center p-3 bg-ming-blue/10 rounded-lg">
          <h3 class="text-ming-red mb-1">æœ€é«˜é‡Œç¨‹</h3>
          <p class="text-2xl font-bold" id="highScore">0 ä¸ˆ</p>
        </div>
        <div class="text-center p-3 bg-ming-blue/10 rounded-lg">
          <h3 class="text-ming-red mb-1">æ¸¸æˆæ¬¡æ•°</h3>
          <p class="text-2xl font-bold" id="gameCount">0</p>
        </div>
        <div class="text-center p-3 bg-ming-blue/10 rounded-lg">
          <h3 class="text-ming-red mb-1">æœ€ä½³æˆç»©</h3>
          <p class="text-2xl font-bold" id="bestStreak">0 ç§’</p>
        </div>
      </div>
    </div>
  </main>

  <!-- é¡µè„š -->
  <footer class="mt-12 py-6 border-t border-ming-gold/50 dark:border-ming-gold/30 text-center">
    <p>Â© 2013-2026 MingDynasty,Inc. å¤§æ˜æ¼‚æµ | Ming surf</p>
    <p class="mt-2 text-sm opacity-70">ä½¿ç”¨ â† â†’ æ–¹å‘é”®æ§åˆ¶ | æŒ‰ESCæš‚åœ</p>
  </footer>

  <script>
    // æ¸¸æˆä¸»é€»è¾‘
    document.addEventListener('DOMContentLoaded', () => {
      // DOMå…ƒç´ 
      const themeToggle = document.getElementById('themeToggle');
      const soundToggle = document.getElementById('soundToggle');
      const startGameBtn = document.getElementById('startGame');
      const gameMenu = document.getElementById('gameMenu');
      const gameArea = document.getElementById('gameArea');
      const gameStats = document.getElementById('gameStats');
      const characterOptions = document.querySelectorAll('.character-option');
      
      // æ¸¸æˆUIå…ƒç´ 
      const gameCanvas = document.getElementById('gameCanvas');
      const ctx = gameCanvas.getContext('2d');
      const startBtn = document.getElementById('startBtn');
      const pauseBtn = document.getElementById('pauseBtn');
      const resumeBtn = document.getElementById('resumeBtn');
      const restartBtn = document.getElementById('restartBtn');
      const playAgainBtn = document.getElementById('playAgainBtn');
      const scoreDisplay = document.getElementById('scoreDisplay');
      const finalScore = document.getElementById('finalScore');
      const timerDisplay = document.getElementById('timerDisplay');
      
      // è¦†ç›–å±‚
      const gameStartOverlay = document.getElementById('gameStartOverlay');
      const gamePauseOverlay = document.getElementById('gamePauseOverlay');
      const gameOverOverlay = document.getElementById('gameOverOverlay');
      
      // æ¸¸æˆçŠ¶æ€
      let gameState = {
        isRunning: false,
        isPaused: false,
        score: 0,
        highScore: localStorage.getItem('mingSurfHighScore') || 0,
        gameCount: localStorage.getItem('mingSurfGameCount') || 0,
        bestStreak: localStorage.getItem('mingSurfBestStreak') || 0,
        lives: 3,
        time: 0,
        timerInterval: null,
        gameMode: 'endless',
        difficulty: 'easy',
        character: 'scholar',
        speed: 5,
        obstacles: [],
        powerups: [],
        player: {
          x: 0,
          y: 0,
          width: 40,
          height: 60,
          speed: 8
        }
      };
      
      // æ›´æ–°ç»Ÿè®¡æ˜¾ç¤º
      document.getElementById('highScore').textContent = `${gameState.highScore} ä¸ˆ`;
      document.getElementById('gameCount').textContent = gameState.gameCount;
      document.getElementById('bestStreak').textContent = `${gameState.bestStreak} ç§’`;
      
      // ä¸»é¢˜åˆ‡æ¢
      themeToggle.addEventListener('click', () => {
        document.documentElement.classList.toggle('dark');
      });
      
      // å£°éŸ³åˆ‡æ¢
      let soundEnabled = true;
      soundToggle.addEventListener('click', () => {
        soundEnabled = !soundEnabled;
        const icon = soundToggle.querySelector('i');
        if (soundEnabled) {
          icon.classList.remove('fa-volume-off');
          icon.classList.add('fa-volume-up');
        } else {
          icon.classList.remove('fa-volume-up');
          icon.classList.add('fa-volume-off');
        }
      });
      
      // è§’è‰²é€‰æ‹©
      characterOptions.forEach(option => {
        option.addEventListener('click', () => {
          characterOptions.forEach(opt => opt.classList.remove('selected', 'border-ming-red'));
          option.classList.add('selected', 'border-ming-red');
          gameState.character = option.dataset.char;
        });
      });
      
      // å¼€å§‹æ¸¸æˆ
      startGameBtn.addEventListener('click', () => {
        // è·å–é€‰æ‹©çš„æ¨¡å¼å’Œéš¾åº¦
        gameState.gameMode = document.querySelector('input[name="gameMode"]:checked').value;
        gameState.difficulty = document.querySelector('input[name="difficulty"]:checked').value;
        
        // æ ¹æ®éš¾åº¦è®¾ç½®é€Ÿåº¦
        switch(gameState.difficulty) {
          case 'easy': gameState.speed = 5; break;
          case 'medium': gameState.speed = 7; break;
          case 'hard': gameState.speed = 9; break;
        }
        
        // æ˜¾ç¤ºæ¸¸æˆåŒºåŸŸï¼Œéšè—èœå•
        gameMenu.classList.add('hidden');
        gameArea.classList.remove('hidden');
        gameStats.classList.remove('hidden');
        
        // è°ƒæ•´ç”»å¸ƒå¤§å°
        resizeCanvas();
        
        // åˆå§‹åŒ–æ¸¸æˆ
        initGame();
      });
      
      // è°ƒæ•´ç”»å¸ƒå¤§å°
      function resizeCanvas() {
        const container = gameCanvas.parentElement;
        gameCanvas.width = container.clientWidth;
        gameCanvas.height = container.clientHeight;
        
        // é‡ç½®ç©å®¶ä½ç½®
        gameState.player.x = gameCanvas.width / 2 - gameState.player.width / 2;
        gameState.player.y = gameCanvas.height - gameState.player.height - 20;
      }
      
      // åˆå§‹åŒ–æ¸¸æˆ
      function initGame() {
        gameState.isRunning = false;
        gameState.isPaused = false;
        gameState.score = 0;
        gameState.lives = 3;
        gameState.time = 0;
        gameState.obstacles = [];
        gameState.powerups = [];
        
        // æ›´æ–°UI
        scoreDisplay.textContent = '0';
        updateLives();
        
        // æ˜¾ç¤ºå¼€å§‹ç•Œé¢
        gameStartOverlay.style.pointerEvents = 'auto';
        
        // å¦‚æœæ˜¯è®¡æ—¶èµ›ï¼Œæ˜¾ç¤ºè®¡æ—¶å™¨
        if (gameState.gameMode === 'timed') {
          timerDisplay.classList.remove('hidden');
          timerDisplay.querySelector('span').textContent = '00:00';
        } else {
          timerDisplay.classList.add('hidden');
        }
        
        // ç»˜åˆ¶åˆå§‹ç”»é¢
        drawGame();
      }
      
      // å¼€å§‹æ¸¸æˆæŒ‰é’®
      startBtn.addEventListener('click', () => {
        gameStartOverlay.style.pointerEvents = 'none';
        gameState.isRunning = true;
        
        // é‡ç½®æ¸¸æˆè®¡æ•°
        gameState.gameCount++;
        localStorage.setItem('mingSurfGameCount', gameState.gameCount);
        document.getElementById('gameCount').textContent = gameState.gameCount;
        
        // å¼€å§‹æ¸¸æˆå¾ªç¯
        if (gameState.gameMode === 'timed') {
          startTimer();
        }
        
        gameLoop();
      });
      
      // æš‚åœæŒ‰é’®
      pauseBtn.addEventListener('click', () => {
        pauseGame();
      });
      
      // ç»§ç»­æŒ‰é’®
      resumeBtn.addEventListener('click', () => {
        resumeGame();
      });
      
      // é‡æ–°å¼€å§‹æŒ‰é’®
      restartBtn.addEventListener('click', () => {
        resumeGame();
        initGame();
      });
      
      // å†ç©ä¸€æ¬¡æŒ‰é’®
      playAgainBtn.addEventListener('click', () => {
        gameOverOverlay.style.opacity = '0';
        gameOverOverlay.style.pointerEvents = 'none';
        initGame();
      });
      
      // æš‚åœæ¸¸æˆ
      function pauseGame() {
        if (!gameState.isRunning || gameState.isPaused) return;
        
        gameState.isPaused = true;
        gamePauseOverlay.style.opacity = '1';
        gamePauseOverlay.style.pointerEvents = 'auto';
        
        if (gameState.timerInterval) {
          clearInterval(gameState.timerInterval);
        }
      }
      
      // æ¢å¤æ¸¸æˆ
      function resumeGame() {
        if (!gameState.isRunning || !gameState.isPaused) return;
        
        gameState.isPaused = false;
        gamePauseOverlay.style.opacity = '0';
        gamePauseOverlay.style.pointerEvents = 'none';
        
        if (gameState.gameMode === 'timed' && gameState.isRunning) {
          startTimer();
        }
        
        gameLoop();
      }
      
      // å¼€å§‹è®¡æ—¶å™¨
      function startTimer() {
        if (gameState.timerInterval) {
          clearInterval(gameState.timerInterval);
        }
        
        gameState.timerInterval = setInterval(() => {
          gameState.time++;
          const minutes = Math.floor(gameState.time / 60).toString().padStart(2, '0');
          const seconds = (gameState.time % 60).toString().padStart(2, '0');
          timerDisplay.querySelector('span').textContent = `${minutes}:${seconds}`;
        }, 1000);
      }
      
      // æ›´æ–°ç”Ÿå‘½å€¼æ˜¾ç¤º
      function updateLives() {
        const lifeIcons = document.querySelectorAll('.life-icon');
        lifeIcons.forEach((icon, index) => {
          if (index < gameState.lives) {
            icon.classList.remove('bg-gray-500');
            icon.classList.add('bg-ming-red');
          } else {
            icon.classList.remove('bg-ming-red');
            icon.classList.add('bg-gray-500');
          }
        });
      }
      
      // ç”Ÿæˆéšœç¢
      function generateObstacle() {
        const obstacleWidth = Math.random() * 60 + 40;
        const x = Math.random() * (gameCanvas.width - obstacleWidth);
        
        gameState.obstacles.push({
          x,
          y: -100,
          width: obstacleWidth,
          height: 40,
          speed: gameState.speed
        });
        
        // éšæœºç”Ÿæˆé“å…·
        if (Math.random() < 0.15) {
          const powerupTypes = ['life', 'speed', 'score'];
          const type = powerupTypes[Math.floor(Math.random() * powerupTypes.length)];
          
          gameState.powerups.push({
            x: Math.random() * (gameCanvas.width - 30),
            y: -100,
            width: 30,
            height: 30,
            speed: gameState.speed,
            type
          });
        }
      }
      
      // ç¢°æ’æ£€æµ‹
      function checkCollisions() {
        // ç©å®¶ç¢°æ’æ¡†
        const playerRect = {
          x: gameState.player.x + 5,
          y: gameState.player.y + 5,
          width: gameState.player.width - 10,
          height: gameState.player.height - 10
        };
        
        // æ£€æµ‹ä¸éšœç¢çš„ç¢°æ’
        for (let i = 0; i < gameState.obstacles.length; i++) {
          const obs = gameState.obstacles[i];
          const obsRect = {
            x: obs.x,
            y: obs.y,
            width: obs.width,
            height: obs.height
          };
          
          if (rectCollision(playerRect, obsRect)) {
            // ç¢°æ’å‘ç”Ÿ
            gameState.lives--;
            updateLives();
            
            // ç§»é™¤ç¢°æ’çš„éšœç¢
            gameState.obstacles.splice(i, 1);
            
            // æ’­æ”¾ç¢°æ’éŸ³æ•ˆ
            if (soundEnabled) {
              // è¿™é‡Œå¯ä»¥æ·»åŠ éŸ³æ•ˆæ’­æ”¾
            }
            
            // æ£€æŸ¥æ¸¸æˆç»“æŸ
            if (gameState.lives <= 0) {
              endGame();
            }
            
            return;
          }
        }
        
        // æ£€æµ‹ä¸é“å…·çš„ç¢°æ’
        for (let i = 0; i < gameState.powerups.length; i++) {
          const powerup = gameState.powerups[i];
          const powerupRect = {
            x: powerup.x,
            y: powerup.y,
            width: powerup.width,
            height: powerup.height
          };
          
          if (rectCollision(playerRect, powerupRect)) {
            // æ ¹æ®é“å…·ç±»å‹æ‰§è¡Œæ•ˆæœ
            switch(powerup.type) {
              case 'life':
                gameState.lives = Math.min(3, gameState.lives + 1);
                updateLives();
                break;
              case 'speed':
                gameState.speed += 2;
                setTimeout(() => {
                  gameState.speed -= 2;
                }, 5000);
                break;
              case 'score':
                gameState.score += 50;
                scoreDisplay.textContent = gameState.score;
                break;
            }
            
            // ç§»é™¤é“å…·
            gameState.powerups.splice(i, 1);
            
            // æ’­æ”¾é“å…·éŸ³æ•ˆ
            if (soundEnabled) {
              // è¿™é‡Œå¯ä»¥æ·»åŠ éŸ³æ•ˆæ’­æ”¾
            }
            
            return;
          }
        }
      }
      
      // çŸ©å½¢ç¢°æ’æ£€æµ‹
      function rectCollision(rect1, rect2) {
        return rect1.x < rect2.x + rect2.width &&
               rect1.x + rect1.width > rect2.x &&
               rect1.y < rect2.y + rect2.height &&
               rect1.y + rect1.height > rect2.y;
      }
      
      // ç»“æŸæ¸¸æˆ
      function endGame() {
        gameState.isRunning = false;
        
        // åœæ­¢è®¡æ—¶å™¨
        if (gameState.timerInterval) {
          clearInterval(gameState.timerInterval);
          gameState.timerInterval = null;
        }
        
        // æ›´æ–°æœ€é«˜åˆ†
        if (gameState.score > gameState.highScore) {
          gameState.highScore = gameState.score;
          localStorage.setItem('mingSurfHighScore', gameState.highScore);
          document.getElementById('highScore').textContent = `${gameState.highScore} ä¸ˆ`;
        }
        
        // æ›´æ–°æœ€ä½³æ—¶é—´
        if (gameState.time > gameState.bestStreak) {
          gameState.bestStreak = gameState.time;
          localStorage.setItem('mingSurfBestStreak', gameState.bestStreak);
          document.getElementById('bestStreak').textContent = `${gameState.bestStreak} ç§’`;
        }
        
        // æ˜¾ç¤ºæœ€ç»ˆåˆ†æ•°
        finalScore.textContent = gameState.score;
        
        // æ˜¾ç¤ºæ¸¸æˆç»“æŸç•Œé¢
        gameOverOverlay.style.opacity = '1';
        gameOverOverlay.style.pointerEvents = 'auto';
      }
      
      // ç»˜åˆ¶æ¸¸æˆ
      function drawGame() {
        if (!gameState.isRunning || gameState.isPaused) return;
        
        // æ¸…ç©ºç”»å¸ƒ
        ctx.clearRect(0, 0, gameCanvas.width, gameCanvas.height);
        
        // ç»˜åˆ¶èƒŒæ™¯ (æ˜æœé£æ ¼çš„æ°´é¢)
        drawBackground();
        
        // ç»˜åˆ¶ç©å®¶
        drawPlayer();
        
        // æ›´æ–°å¹¶ç»˜åˆ¶éšœç¢
        updateObstacles();
        
        // æ›´æ–°å¹¶ç»˜åˆ¶é“å…·
        updatePowerups();
        
        // æ£€æµ‹ç¢°æ’
        checkCollisions();
        
        // æ›´æ–°åˆ†æ•°
        gameState.score++;
        scoreDisplay.textContent = gameState.score;
        
        // æ¸¸æˆå¾ªç¯
        requestAnimationFrame(drawGame);
      }
      
      // ç»˜åˆ¶èƒŒæ™¯
      function drawBackground() {
        // æ°´é¢æ¸å˜
        const gradient = ctx.createLinearGradient(0, 0, 0, gameCanvas.height);
        if (document.documentElement.classList.contains('dark')) {
          gradient.addColorStop(0, '#0A2A5A');
          gradient.addColorStop(1, '#051A3A');
        } else {
          gradient.addColorStop(0, '#4A90E2');
          gradient.addColorStop(1, '#1A5599');
        }
        
        ctx.fillStyle = gradient;
        ctx.fillRect(0, 0, gameCanvas.width, gameCanvas.height);
        
        // ç»˜åˆ¶æ°´é¢æ³¢çº¹ (æ˜æœæ°´çº¹å›¾æ¡ˆ)
        ctx.strokeStyle = document.documentElement.classList.contains('dark') ? '#2A70C2' : '#7AB0F2';
        ctx.lineWidth = 2;
        
        for (let i = 0; i < 5; i++) {
          const y = (gameCanvas.height / 5) * i + Math.sin(Date.now() / 500 + i) * 10;
          ctx.beginPath();
          ctx.moveTo(0, y);
          
          // ç»˜åˆ¶æ³¢æµªçº¿
          for (let x = 0; x < gameCanvas.width; x += 20) {
            const waveHeight = Math.sin(x / 50 + Date.now() / 300 + i) * 5;
            ctx.lineTo(x, y + waveHeight);
          }
          
          ctx.stroke();
        }
        
        // ç»˜åˆ¶è¿œå¤„çš„å±± (æ˜æœå±±æ°´ç”»é£æ ¼)
        drawMountains();
      }
      
      // ç»˜åˆ¶è¿œå±±
      function drawMountains() {
        ctx.fillStyle = document.documentElement.classList.contains('dark') ? '#1A2A3A' : '#8A9BA8';
        
        // ç¬¬ä¸€åº§å±±
        ctx.beginPath();
        ctx.moveTo(0, gameCanvas.height / 3);
        ctx.lineTo(gameCanvas.width / 4, gameCanvas.height / 6);
        ctx.lineTo(gameCanvas.width / 2, gameCanvas.height / 3);
        ctx.closePath();
        ctx.fill();
        
        // ç¬¬äºŒåº§å±±
        ctx.beginPath();
        ctx.moveTo(gameCanvas.width / 2, gameCanvas.height / 3);
        ctx.lineTo(gameCanvas.width * 3/4, gameCanvas.height / 8);
        ctx.lineTo(gameCanvas.width, gameCanvas.height / 3);
        ctx.closePath();
        ctx.fill();
      }
      
      // ç»˜åˆ¶ç©å®¶
      function drawPlayer() {
        // æ ¹æ®é€‰æ‹©çš„è§’è‰²ç»˜åˆ¶ä¸åŒçš„å½¢è±¡
        ctx.save();
        ctx.translate(gameState.player.x + gameState.player.width/2, gameState.player.y + gameState.player.height/2);
        
        // æœ¨èˆŸåº•åº§ (æ˜æœé£æ ¼çš„æœ¨èˆŸ)
        ctx.fillStyle = '#8B4513'; // æœ¨è‰²
        ctx.beginPath();
        ctx.moveTo(-20, 20);
        ctx.lineTo(-15, -20);
        ctx.lineTo(15, -20);
        ctx.lineTo(20, 20);
        ctx.closePath();
        ctx.fill();
        
        // èˆŸçš„è£…é¥° (æ˜æœçº¹æ ·)
        ctx.strokeStyle = '#D4AF37'; // é‡‘è‰²
        ctx.lineWidth = 2;
        ctx.beginPath();
        ctx.arc(0, 0, 15, 0, Math.PI * 2);
        ctx.stroke();
        
        // æ ¹æ®è§’è‰²ç»˜åˆ¶ä¸åŒçš„äººç‰©
        ctx.fillStyle = document.documentElement.classList.contains('dark') ? '#F5F0E1' : '#232323';
        
        switch(gameState.character) {
          case 'scholar':
            // æ–‡ç”Ÿ
            ctx.beginPath();
            ctx.arc(0, -10, 8, 0, Math.PI * 2); // å¤´
            ctx.fill();
            
            ctx.beginPath();
            ctx.moveTo(0, 0);
            ctx.lineTo(0, 15); // èº«ä½“
            ctx.stroke();
            
            ctx.beginPath();
            ctx.moveTo(0, 5);
            ctx.lineTo(-10, 0); // å·¦æ‰‹
            ctx.stroke();
            
            ctx.beginPath();
            ctx.moveTo(0, 5);
            ctx.lineTo(10, 0); // å³æ‰‹
            ctx.stroke();
            break;
            
          case 'general':
            // æ­¦å°†
            ctx.beginPath();
            ctx.arc(0, -10, 8, 0, Math.PI * 2); // å¤´
            ctx.fill();
            
            ctx.fillRect(-10, 0, 20, 15); // èº«ä½“ (ç›”ç”²)
            
            ctx.beginPath();
            ctx.moveTo(-10, 5);
            ctx.lineTo(-15, 0); // å·¦æ‰‹
            ctx.stroke();
            
            ctx.beginPath();
            ctx.moveTo(10, 5);
            ctx.lineTo(15, 0); // å³æ‰‹
            ctx.stroke();
            break;
            
          case 'merchant':
            // å•†è´¾
            ctx.beginPath();
            ctx.arc(0, -10, 8, 0, Math.PI * 2); // å¤´
            ctx.fill();
            
            ctx.beginPath();
            ctx.ellipse(0, 5, 10, 12, 0, 0, Math.PI * 2); // èº«ä½“
            ctx.fill();
            
            ctx.beginPath();
            ctx.moveTo(-5, 5);
            ctx.lineTo(-10, 0); // å·¦æ‰‹
            ctx.stroke();
            
            ctx.beginPath();
            ctx.moveTo(5, 5);
            ctx.lineTo(10, 0); // å³æ‰‹
            ctx.stroke();
            break;
        }
        
        ctx.restore();
      }
      
      // æ›´æ–°éšœç¢
      function updateObstacles() {
        // éšæœºç”Ÿæˆæ–°éšœç¢
        if (Math.random() < 0.02) {
          generateObstacle();
        }
        
        // ç»˜åˆ¶å¹¶æ›´æ–°æ‰€æœ‰éšœç¢
        for (let i = gameState.obstacles.length - 1; i >= 0; i--) {
          const obs = gameState.obstacles[i];
          
          // æ›´æ–°ä½ç½®
          obs.y += obs.speed;
          
          // ç»˜åˆ¶éšœç¢ (æ˜æœé£æ ¼çš„ç¤çŸ³/æµ®æœ¨)
          ctx.fillStyle = document.documentElement.classList.contains('dark') ? '#5A4A3A' : '#8B7B6B';
          ctx.beginPath();
          ctx.moveTo(obs.x, obs.y);
          ctx.lineTo(obs.x + obs.width/4, obs.y - obs.height/2);
          ctx.lineTo(obs.x + obs.width*3/4, obs.y - obs.height/2);
          ctx.lineTo(obs.x + obs.width, obs.y);
          ctx.lineTo(obs.x + obs.width*3/4, obs.y + obs.height/2);
          ctx.lineTo(obs.x + obs.width/4, obs.y + obs.height/2);
          ctx.closePath();
          ctx.fill();
          
          // ç§»é™¤è¶…å‡ºå±å¹•çš„éšœç¢
          if (obs.y > gameCanvas.height) {
            gameState.obstacles.splice(i, 1);
          }
        }
      }
      
      // æ›´æ–°é“å…·
      function updatePowerups() {
        // ç»˜åˆ¶å¹¶æ›´æ–°æ‰€æœ‰é“å…·
        for (let i = gameState.powerups.length - 1; i >= 0; i--) {
          const powerup = gameState.powerups[i];
          
          // æ›´æ–°ä½ç½®
          powerup.y += powerup.speed;
          
          // æ ¹æ®ç±»å‹ç»˜åˆ¶ä¸åŒçš„é“å…·
          switch(powerup.type) {
            case 'life':
              // ç”Ÿå‘½é“å…· (çº¢è‰²)
              ctx.fillStyle = '#C42021';
              ctx.beginPath();
              ctx.arc(powerup.x + powerup.width/2, powerup.y + powerup.height/2, powerup.width/2, 0, Math.PI * 2);
              ctx.fill();
              ctx.fillStyle = 'white';
              ctx.font = '16px Arial';
              ctx.textAlign = 'center';
              ctx.textBaseline = 'middle';
              ctx.fillText('+1', powerup.x + powerup.width/2, powerup.y + powerup.height/2);
              break;
              
            case 'speed':
              // åŠ é€Ÿé“å…· (é»„è‰²)
              ctx.fillStyle = '#D4AF37';
              ctx.beginPath();
              ctx.arc(powerup.x + powerup.width/2, powerup.y + powerup.height/2, powerup.width/2, 0, Math.PI * 2);
              ctx.fill();
              ctx.fillStyle = 'black';
              ctx.font = '16px Arial';
              ctx.textAlign = 'center';
              ctx.textBaseline = 'middle';
              ctx.fillText('âš¡', powerup.x + powerup.width/2, powerup.y + powerup.height/2);
              break;
              
            case 'score':
              // åˆ†æ•°é“å…· (è“è‰²)
              ctx.fillStyle = '#1A5599';
              ctx.beginPath();
              ctx.arc(powerup.x + powerup.width/2, powerup.y + powerup.height/2, powerup.width/2, 0, Math.PI * 2);
              ctx.fill();
              ctx.fillStyle = 'white';
              ctx.font = '16px Arial';
              ctx.textAlign = 'center';
              ctx.textBaseline = 'middle';
              ctx.fillText('50', powerup.x + powerup.width/2, powerup.y + powerup.height/2);
              break;
          }
          
          // ç§»é™¤è¶…å‡ºå±å¹•çš„é“å…·
          if (powerup.y > gameCanvas.height) {
            gameState.powerups.splice(i, 1);
          }
        }
      }
      
      // é”®ç›˜æ§åˆ¶
      document.addEventListener('keydown', (e) => {
        if (!gameState.isRunning || gameState.isPaused) {
          // ESCé”®æš‚åœ/ç»§ç»­
          if (e.key === 'Escape') {
            if (gameState.isPaused) {
              resumeGame();
            } else if (gameState.isRunning) {
              pauseGame();
            }
          }
          return;
        }
        
        // å·¦ç§»
        if (e.key === 'ArrowLeft' && gameState.player.x > 0) {
          gameState.player.x -= gameState.player.speed;
        }
        
        // å³ç§»
        if (e.key === 'ArrowRight' && gameState.player.x < gameCanvas.width - gameState.player.width) {
          gameState.player.x += gameState.player.speed;
        }
        
        // ç©ºæ ¼é”®åŠ é€Ÿ
        if (e.key === ' ') {
          gameState.speed += 3;
          setTimeout(() => {
            gameState.speed -= 3;
          }, 1000);
        }
      });
      
      // çª—å£å¤§å°è°ƒæ•´
      window.addEventListener('resize', resizeCanvas);
    });
  </script>
</body>
</html>
